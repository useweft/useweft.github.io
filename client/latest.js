!function(){"use strict";var e=document.currentScript,t=e&&e.getAttribute("data-api")||"https://api.useweft.dev",n=e&&"true"===e.getAttribute("data-observe");function r(e,t){try{sessionStorage.setItem(e,t)}catch(e){}}function o(e,t){try{localStorage.setItem(e,t)}catch(e){}}var u="weft:p:"+location.pathname+location.search,c=document.createElement("style");c.id="weft-cloak",c.textContent="body{visibility:hidden!important}",(document.head||document.documentElement).appendChild(c);var i=setTimeout(l,3e3),a=!1;function l(){a||(a=!0,clearTimeout(i),c.parentNode&&c.parentNode.removeChild(c))}var s=function(e){try{return sessionStorage.getItem(e)}catch(e){return null}}(u),d=null,f=!1;s&&((d=document.createElement("link")).rel="stylesheet",d.href=t+"/css/"+s,d.onload=function(){f=!0,w===s&&l()},d.onerror=function(){d=null,f=!1,function(e){try{sessionStorage.removeItem(e)}catch(e){}}(u)},(document.head||document.documentElement).appendChild(d));var h=null;function m(e,t){var n=document.createElement("link");n.rel="stylesheet",n.href=e,n.onload=n.onerror=t||null,v(n)}function v(e){h&&h.parentNode&&h.parentNode.removeChild(h),h=e,document.head.appendChild(e),d&&d!==e&&d.parentNode&&(d.parentNode.removeChild(d),d=null)}function p(){for(var e=Object.create(null),t=document.querySelectorAll("[class]"),n=0;n<t.length;n++)for(var r=t[n].classList,o=0;o<r.length;o++)e[r[o]]=1;return Object.keys(e).sort()}var b=null;function y(){return b?Promise.resolve(b):fetch(t+"/v").then(function(e){if(!e.ok)throw new Error(e.status);return e.json()}).then(function(e){return b=e.v,e.v}).catch(function(e){return console.warn("[weft] version fetch failed",e),b="unknown"})}var w=null,g=!1,S=!1,E=!1;function C(e){return e.length?S?(E=!0,Promise.resolve()):(S=!0,function(e){return y().then(function(n){return function(e,t){var n=e+"\n"+t.join(",");return crypto.subtle.digest("SHA-256",(new TextEncoder).encode(n)).then(function(e){for(var t="",n=new Uint8Array(e),r=0;r<n.length;r++)t+=(n[r]<16?"0":"")+n[r].toString(16);return"b_"+t.slice(0,16)})}(n,e).then(function(n){if(n===s&&d)return w=n,g=!0,h=d,d=null,r(u,n),o("weft:"+n,"1"),void(f&&l());if(n===w)return g=!0,void l();var c=t+"/css/"+n;return function(e){try{return localStorage.getItem(e)}catch(e){return null}}("weft:"+n)?(w=n,g=!0,r(u,n),void m(c,l)):fetch(t+"/compile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classes:e})}).then(function(e){if(!e.ok)throw new Error("compile "+e.status);return e.json()}).then(function(e){var n,c,i;if(w=e.bundleId,g=!0,e.css?(n=e.css,c=l,(i=document.createElement("style")).textContent=n,v(i),c&&c()):m(t+"/css/"+e.bundleId,l),o("weft:"+e.bundleId,"1"),r(u,e.bundleId),e.css){var a=document.createElement("link");a.rel="prefetch",a.href=t+"/css/"+e.bundleId,document.head.appendChild(a)}})})})}(e).then(function(){if(S=!1,E)return E=!1,C(p())},function(e){S=!1,console.warn("[weft]",e),l()})):(l(),g=!0,Promise.resolve())}var I=null,O={version:"0.2.0",rehash:function(){return C(p())},preload:function(e){if(!Array.isArray(e)||!e.length)return Promise.resolve();for(var n=p(),r=Object.create(null),u=0;u<n.length;u++)r[n[u]]=1;for(var c=0;c<e.length;c++)r[e[c]]=1;var i=Object.keys(r).sort();return fetch(t+"/compile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({classes:i})}).then(function(e){if(!e.ok)throw new Error("preload "+e.status);return e.json()}).then(function(e){o("weft:"+e.bundleId,"1")}).catch(function(e){console.warn("[weft] preload failed",e)})},observe:function(e){if("undefined"==typeof MutationObserver)return function(){};I&&I();var t=e&&e.debounce||200,n=null,r=new MutationObserver(function(e){for(var r=0;r<e.length;r++){var o=e[r];if("attributes"===o.type&&"class"===o.attributeName||"childList"===o.type&&o.addedNodes.length)return clearTimeout(n),void(n=setTimeout(function(){C(p())},t))}});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["class"],childList:!0,subtree:!0}),I=function(){clearTimeout(n),r.disconnect(),I=null}},status:function(){return{bundleId:w,version:b,ready:g}}};function j(){C(p()).then(function(){n&&O.observe()})}window.useweft=O,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",j):j()}();